name: resource-dispatcher
summary: Resource dispatcher in a Rock
description: "Resource dispatcher" # TODO: Write better desc
version: "1.0_beta"
base: ubuntu:22.04
license: Apache-2.0

services:
  resource-dispatcher:
    command: /bin/python3 /app/main.py
    override: replace
    startup: enabled

platforms:
  amd64:

parts:
  security-team-requirement:
    plugin: nil
    override-build: |
      mkdir -p /usr/share/rocks
      (echo "# os-release" && cat /etc/os-release && echo "# dpkg-query" && dpkg-query -f '${db:Status-Abbrev},${binary:Package},${Version},${source:Package},${Source:Version}\n' -W) > /usr/share/rocks/dpkg.query

  resource-dispatcher:
    source: .
    plugin: python
    stage-packages:
      - python3-venv
      - tzdata
    python-requirements:
      - requirements.txt

  resources:
    source: resource_dispatcher
    plugin: dump
    organize:
      "*": "app/"
